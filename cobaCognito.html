<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="author" content="">
		<meta name="version" content="Bootstrap 3.3.5">
		<title>Portal Coba AWS JS</title>

		<link href="styles/bootstrap.min.css" rel="stylesheet">
		<link href="styles/bootstrap-extended.css" rel="stylesheet">
		<link href="styles/bootstrap-extended-theme.css" rel="stylesheet">

		<!-- [if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif] -->

		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="icon" href="images/favicon.ico">
	</head>
	<body>


		<script src="scripts/jquery-2.1.4.min.js"></script>
		<script src="scripts/bootstrap.min.js"></script>
		<script src="scripts/bootstrap-extended.js"></script>
		<script src="scripts/aws-sdk-2.1.44.min.js"></script>
<!-- 		<script src="scripts/amazon-cognito.min.js"></script> -->


		<button id="sudah_login">sudah login loh</button>
		
		
		<div id="status"></div>
		<ul id="objects"></ul>

		<input type="file" id="file-chooser" /> 
		<button id="upload-button">Upload to S3</button>
		<div id="results"></div>


		<script type="text/javascript">
		
		AWS.config.region = 'us-east-1';
		AWS.config.logger = console;
				
		var params = {
				  IdentityPoolId: 'us-east-1:b224255c-d08c-4532-b2d1-ff9cf734eaa6', /* required */
				  RoleArn: 'arn:aws:iam::426588886354:role/Cognito_identityPoolPertamaAuth_Role',
				  Logins: { /* required */
				    'developerProviderNameSendiri':'user1'
				  },
				  IdentityId: 'us-east-1:067e98fb-a231-4e0b-a5d4-5bb5882ce7d9',
				  TokenDuration: 86400
				};
		
		//set the default config object
		var creds = new AWS.CognitoIdentityCredentials(params);
		AWS.config.credentials = creds;
		
		
/* 
		var cognitoidentity = new AWS.CognitoIdentity();
		
		cognitoidentity.getOpenIdTokenForDeveloperIdentity(params, function(err, data) {
			  if (err) console.log(err, err.stack); // an error occurred
			  else     console.log(data);           // successful response
		});
 */
		
		
 
 
	var bucket = new AWS.S3(
			{
				params: {Bucket: 'jcha'}
			}
		);
		bucket.listObjects(function (err, data) {
			if (err) {
				document.getElementById('status').innerHTML = 'Could not load objects from S3';
			} else {
				document.getElementById('status').innerHTML = 'Loaded ' + data.Contents.length + ' items from S3';
				for (var i = 0; i < data.Contents.length; i++) {
					document.getElementById('objects').innerHTML += '<li>' + data.Contents[i].Key + '</li>';
				}
			}
		}); // end bucket.listObjects
	  
		var fileChooser = document.getElementById('file-chooser');
		var button = document.getElementById('upload-button');
		var results = document.getElementById('results');

		button.addEventListener('click', function() {
			var file = fileChooser.files[0];
			if (file) {
				
				
				var identityId = "us-east-1:067e98fb-a231-4e0b-a5d4-5bb5882ce7d9";
				
				console.log(identityId);
				
				var params = 
				{
					Key: identityId+'/'+file.name, 
					ContentType: file.type, 
					Body: file
				};
				
				results.innerHTML = '';

/* 					bucket.upload(params, function (err, data) {
					results.innerHTML = err ? 'ERROR!' : 'UPLOADED.';
					  
				});
*/					
				
		        var req = bucket.putObject(params)
		        	.on('httpUploadProgress', function (progress) {
		            	console.log(progress);
		          	})
		          	.send(function (err, data) {
		            	console.log("FINISHED");
			            if (err) {
			              results.innerHTML += '<p>ERROR UPLOADING ' + files[i].name + '</p>';
			            } else {
			              var url = bucket.getSignedUrl('getObject', {Key: params.Key});
			              console.log(url)
			              results.innerHTML += '<img src="' + url + '">';
			            }
					}); // end .send
				
			} else {
				results.innerHTML = 'Nothing to upload.';
			} // end if file
		}, false); // end on click
 
 

		</script>

	</body>
</html>
